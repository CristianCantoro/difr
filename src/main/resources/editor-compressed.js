$().ready(function(){var a=false;$(document).on("click",".line",function(j){j.preventDefault();if(!a){var b=$(j.target).parent(".line");var d=ich.editor({});var h=d.find("#contents");var i=d.find(".cancel");function c(e){h.off("keyup");i.off("click");d.slideUp(200,function(){d.remove();a=false;if(e){e()}})}function g(){c()}function f(){c(function(){console.info("Saved "+h.val());var k=h.val();var e=ich.comments({comments:k});e.insertAfter(b)})}h.keyup(function(k){switch(event.which){case 13:event.preventDefault();f();break;case 27:event.preventDefault();g();break}});d.insertAfter(b);d.slideDown(200);i.on("click",function(){console.info("Cancelled");g()});h.focus();a=true}})});